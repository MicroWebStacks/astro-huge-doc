---
import Highlighter from './Highlighter.astro'
import Kroki from './Kroki.astro'
import ModelViewerCode from '../model/ModelViewerCode.astro';
import Cards from '../cards/Cards.astro'
import Gallery from '../../gallery/gallery.astro';
import Swiper from '../../swiper/swiper.astro'
import kroki from './kroki.yaml'
import {getMetaData} from '@/libs/assets.js'
import { getAssetWithBlob } from '@/libs/structure-db';
import DiagramCode from './DiagramCode.astro';

export interface Props {
    item: {
        asset_uid: string;
    }
}

const { item } = Astro.props as Props;
const {asset, buffer} = getAssetWithBlob(item.asset_uid)
const code = new TextDecoder().decode(buffer)

const language = asset.ext ?? 'plaintext'
const params = asset.params?asset.params.split(' '):[]
const asset_uid = item.asset_uid

const yaml_glb      = ((language == "yaml") && (asset.params?.startsWith("glb")))
const yaml_cards    = ((language == "yaml") && (asset.params?.startsWith("cards")))
const yaml_gallery  = ((language == "yaml") && (asset.params?.startsWith("gallery")))
const yaml_swiper  = ((language == "yaml") && (asset.params?.startsWith("swiper")))

const is_diagram = kroki.languages.includes(language)
const custom_yaml = yaml_glb || yaml_cards || yaml_gallery || yaml_swiper
const other_language = (!is_diagram && !custom_yaml)

---
{(is_diagram)&&
    <DiagramCode uid={asset_uid} code={code} language={language} params={params} meta={asset.params} />
}
{yaml_glb &&
    <ModelViewerCode uid={asset_uid} code={code} ast={item.ast}/>
}

